# サックスモード: スパン入れ替え機能（ドラッグ&ドロップ）

本機能は、サックスモード（`currentMode === 'draw'`）で作図済みのスパン（布材）を、各スパン中点のハンドルをドラッグ&ドロップするだけで任意の順序に入れ替えられる UI を提供します。

## できること

- 各スパン（布材）の中点に、小さな丸いハンドルが表示されます。
- ハンドルをドラッグしてドロップすると、ドロップ位置に応じてスパンが入れ替わります。
- 入れ替えは「スパン単位」で行われ、全体の長さは維持されます。
- 柱・ブラケット・アンチ等はオフセット（mm）基準で配置されているため、スパン順序の変更後も整合が保たれます。

## 使い方

1. 作図画面をサックスモード（描画モード）にします。
2. 既に作図されたスパンの上に、各スパン中点の小さな丸ハンドルが表示されます。
3. ハンドルを掴んでスパン線上にドラッグし、目的の位置でドロップします。
4. ドロップ位置の前後スパンの中点を基準に、新しい順序へ入れ替えられます。

## 実装のポイント

- 対象は `ScaffoldRenderer` 内の布材（`type === '布材'` かつ `meta.lineStyle !== 'dashed'`）。
- ドラッグ中はハンドルの座標をスパン直線上へ拘束（`dragBoundFunc`）。
- ドロップ時にキャンバス座標をスパンの沿い距離（mm）へ変換し、各スパン中点の中間点で分割したインデックスへ挿入します。
- 並び替え後は `offsetMm` を再計算し、`position` をスパンの始点からの距離（mm）に応じて再配置します。
- 柱・ブラケット・アンチの位置（`offsetMm`）は固定のため、入れ替え後も境界の柱・ブラケット位置は一致します。

## コード位置

- ハンドル描画とドラッグイベント: `frontend/src/app/(protected)/draw/components/ScaffoldRenderer.tsx`
- スケール変換ユーティリティ: `frontend/src/lib/utils/scale.ts`

## 追加済みプレビュー

- ドラッグ中のリアルタイム並び替えプレビュー
  - ドラッグしている間、対象スパンは直線上の仮位置へ移動して表示されます
  - 挿入位置の目印として直交方向の短いティックを描画します

## 今後の拡張

- キーボード操作（←/→）でのインデックス移動
- 入れ替え履歴の Undo/Redo（現在も履歴保存は有効）
